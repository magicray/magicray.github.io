<!doctype html>
<html lang="en">
<head>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
<title>Stocks</title>
</head>
<body>
    <div class="div container">
        <div class="row align-items-end">
            <div class="col-8" id="timestamp"></div>
            <div class="col"><input id="filter" type="text"></div>
        </div>
        <div class="row">
        <table id="table" class="table table-striped table-bordered">
            <thead>
                <tr>
                <th rowspan=3>Rank</th>
                <th rowspan=3>Name</th>
                <th colspan=2>Profitability</th>
                <th colspan=2>YoY Quarterly Growth %</th>
                <th colspan=2>Valuation</th>
                <th rowspan=3>Price</th>
                <th rowspan=3>Market Cap</th>
                <th rowspan=3>Quantity</th>
                </tr><tr>
                <th id="roce"></th>
                <th id="roe"></th>
                <th id="profit"></th>
                <th id="sales"></th>
                <th id="yield"></th>
                <th id="pe"></th>
                </tr><tr>
                <th>ROCE</th>
                <th>ROE</th>
                <th>Profit</th>
                <th>Sales</th>
                <th>Yield</th>
                <th>PE</th>
                </tr>
            </thead>
        </table>
        </div>
    </div>
</body>
<script>
$('#filter').keyup(function(e) {
    table.fnFilter(this.value)
})
const table = $('#table').dataTable({
    'bPaginate': false,
    'ajax': {
        'url': 'https://magicray.github.io/magicrank.json',
        'dataSrc': function(data) {
            $('#timestamp').html(
                'Stocks ranked on Profitability, Growth and Valuation.<br>' +
                'Updated on ' + data['date'])
            $('#roce').text(Math.floor(data['stats']['roce'][1]))
            $('#roe').text(Math.floor(data['stats']['roe'][1]))
            $('#profit').text(Math.floor(data['stats']['qtr_profit_var'][1]))
            $('#sales').text(Math.floor(data['stats']['qtr_sales_var'][1]))
            $('#yield').text(Math.floor(data['stats']['earnings_yield'][1]))
            $('#pe').text(Math.floor(data['stats']['p_e'][1]))

            const amount = parseInt(window.location.hash.substr(1))
            return data['data'].map(d => [
                d['rank'],
                d['name'],
                Math.floor(d['roce']),
                Math.floor(d['roe']),
                Math.floor(d['qtr_profit_var']),
                Math.floor(d['qtr_sales_var']),
                Math.floor(d['earnings_yield']),
                Math.floor(d['p_e']),
                Math.floor(d['cmp_rs']),
                Math.floor(d['mar_cap_rs_cr']),
                amount && d['rank'] < 51? Math.floor(amount/(50*d['cmp_rs'])):''
            ])
        }},
})
$('.dataTables_filter').hide()
</script>
</html>
